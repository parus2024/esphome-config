addressable_lambda:
  name: Confetti Parus
  update_interval: 50ms
  lambda: |-
    // СЛАЙДЕРЫ
    int speed_val = id(effect_speed).state;      // 0–255: скорость затухания
    int scale_val = id(effect_scale).state;       // 0–255: плотность конфетти
    int intensity_val = id(effect_intensity).state; // 0–255: яркость и разброс цветов


    if (initial_run) {
      ESP_LOGD("effect", "Confetti Parus");
    }

    // 1. ЗАТУХАНИЕ (регулируется effect_speed)
    int fade_amount = 20 + (speed_val * 80) / 255;  // 20–100
    it.all().fade_to_black(fade_amount);

    // 2. КОЛИЧЕСТВО ТОЧЕК (регулируется effect_scale)
    int base_dots = std::max(1, (int)(it.size() / 100.0));
    int num_dots = base_dots + (scale_val * base_dots) / 255;  // Увеличиваем плотность
    num_dots = std::min(static_cast<int>(num_dots), static_cast<int>(it.size() / 10));  // Лимит: не больше 10% ленты

    // 3. ПАРАМЕТРЫ ЦВЕТА (регулируются effect_intensity)
    int hue_range = 50 + (intensity_val * 50) / 255;     // 50–100: ширина палитры
    int saturation = 150 + (intensity_val * 105) / 255;   // 150–255: насыщенность
    int brightness = intensity_val;                        // 0–255: яркость

    // 4. ДОБАВЛЕНИЕ НОВЫХ ТОЧЕК
    for (int x = 0; x < num_dots; x++) {
      int pos = random(it.size());

      // Случайный оттенок в заданном диапазоне
      int base_hue = 0;  // Базовый оттенок (можно изменить на 60 для жёлтого и т.д.)
      int random_hue = base_hue + random(-hue_range/2, hue_range/2);
      random_hue = (random_hue + 360) % 360;  // Корректировка в 0–359

      it[pos] = ESPHSVColor(random_hue, saturation, brightness);
    }
